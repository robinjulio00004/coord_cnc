<!doctype html>
<!--coordenadas en CNC-->
<html lang="en-US">
	<head>
	<meta charset="utf-8"/> 
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="apple-mobile-web-app-capable" content="yes">
    	<script src="aframe-v1.6.0.min.js"></script>
    	<script src="aframe-ar.js"></script>
		<link rel="stylesheet" href="styles.css">
	</head>
<body>
	<!-- Canvas -->
	<canvas id="micanvas"></canvas>
	<!-- Botones -->
	<div id="botones">
        <input id="button1" type="submit" class="reset" value="Restablecer" onClick="restablecer()"> <!-- restablecer valores-->
    </div>
	<!-- Valores de salida -->
	<div class="fmsg">
 	 <div>
	<p>coordenada X: <span id="cx">&nbsp;</span></p>
	 </div>
	 <div>
	<p>coordenada Y: <span id="cy"></span></p>
	 </div>
	</div>
 	 <div id="mcode">
	<p>%<br>;Muestra de programa en c√≥digo G y M<br><br>O0001</p>
	<p id="clineas"></p>
	 </div>
		 
	<!-- Scene -->
	<a-scene arjs embedded renderer="logarithmicDepthBuffer: true;" xr-mode-ui="enabled: true">
	<!-- Asset Management -->	
	<a-assets>
	<img id="img1" src="coord_sist.png">
	<img id="img2" src="cero_pieza.png">
    <a-asset-item id="tool" src="cortador.glb"></a-asset-item>
  	</a-assets>

	<a-image src="#img1" position="0 0.5 0" rotation="0 0 -90" width="3" height="2.3"></a-image>
	<a-image src="#img2" position="0 0.5 0" rotation="0 0 -90" width="0.25" height="0.25"></a-image>
	<a-entity gltf-model="#tool" position="0 0.5 0" rotation="180 0 0" scale="1.5 1.5 1.5" touch-move></a-entity>
		
	<!-- Camera -->
	<a-entity camera position="0 0 6" look-controls-enabled="false"></a-entity>
	</a-scene>
</body>

	<script>
			let i=1, coordx=0, coordy=0,dx=158,dy=59,fescalax=6.6,fescalay=22,canvx=0,canvy=0, stexto = new Array();
			const canvas = document.getElementById("micanvas");
			const ctx = canvas.getContext("2d");	
			ctx.beginPath();
			ctx.moveTo(dx,dy);
			stexto[0]= "N01 G00 G90 G54 X0. Y0. Z1.<br>";
			document.getElementById("clineas").innerHTML = stexto[0];
		    AFRAME.registerComponent('touch-move', {
        		init: function () {
          	this.el.sceneEl.addEventListener('touchmove', this.onTouchMove.bind(this));
			this.el.sceneEl.addEventListener('touchend', this.onTouchEnd.bind(this));
        },
        		onTouchMove: function (evt) {
			evt.preventDefault(); // Prevent default browser behavior (e.g., scrolling)
			const scale = 0.006;
			var xt = (evt.touches[0].clientX-window.innerWidth/2)*scale;
			var yt = (window.innerHeight/2-evt.touches[0].clientY)*scale;
				xt=xt.toFixed(1);
				yt=yt.toFixed(1);
				if(xt>1.0)
				{
					xt=1.0;
				}
				else if(xt<-1.0)
				{
					xt=-1.0;
				}
				else if(yt>1.8)
				{
					yt=1.8;
				}
				else if(yt<-0.8)
				{
					yt=-0.8;
				}
					coordx=-yt+0.5;
					coordx=coordx.toFixed(1)*5;
					coordy=xt*5;
			document.getElementById('cx').textContent = coordx; // X-coordinate virtual axis
			document.getElementById('cy').textContent = coordy; // Y-coordinate virtual axis
			this.el.setAttribute('position', {x: xt, y: yt, z: 0});
        },
				onTouchEnd: function (evt) {
			evt.preventDefault(); // Prevent default browser behavior (e.g., scrolling)
			stexto[i]= "N0"+(i+1)+" X"+coordx+" Y"+coordy+" <br>";
			stexto[i+1]="N0"+(i+2)+" M30<br>%";
			document.getElementById("clineas").innerHTML = stexto[i];
			document.getElementById("clineas").innerHTML = stexto[i+1];
			document.getElementById("clineas").innerHTML = stexto.join("");
					i++;
					ctx.lineTo(dx+coordy*fescalay,dy+coordx*fescalax);
					ctx.lineWidth=1;
					ctx.strokeStyle="cyan";
					ctx.stroke();
		},
      });
			function restablecer()
			{
				ctx.reset();
				ctx.beginPath();
				//ctx.moveTo(dx+coordy*fescalay,dy+coordx*fescalax);//incrementales
				ctx.moveTo(dx,dy);
				//document.querySelector('#tool').setAttribute('position', {x: 0, y: 0.5, z: 0});
				document.querySelector('#tool').object3D.position.set(0, 0.5, 0);
			}
	</script>
</html>


























